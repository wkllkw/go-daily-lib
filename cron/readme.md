### 概述

安装cron，目前最新稳定版本为 v3：
`$ go get -u github.com/robfig/cron/v3`

使用非常简单，创建cron对象，这个对象用于管理定时任务。

调用cron对象的`AddFunc()`方法向管理器中添加定时任务。`AddFunc()`接受两个参数，参数 1 以字符串形式指定触发时间规则，参数 2 是一个无参的函数，每次触发时调用。`@every 1s`表示每秒触发一次，`@every`后加一个时间间隔，表示每隔多长时间触发一次。例如`@every 1h`表示每小时触发一次，`@every 1m2s`表示每隔 1 分 2 秒触发一次。`time.ParseDuration()`支持的格式都可以用在这里。

调用`c.Start()`启动定时循环。

### 时间格式

与Linux 中crontab命令相似，cron库支持用 5 个空格分隔的域来表示时间。这 5 个域含义依次为：

* Minutes：分钟，取值范围[0-59]，支持特殊字符* / , -；

* Hours：小时，取值范围[0-23]，支持特殊字符* / , -；

* Day of month：每月的第几天，取值范围[1-31]，支持特殊字符* / , - ?；

* Month：月，取值范围[1-12]或者使用月份名字缩写[JAN-DEC]，支持特殊字符* / , -；

* Day of week：周历，取值范围[0-6]或名字缩写[JUN-SAT]，支持特殊字符* / , - ?。
注意，月份和周历名称都是不区分大小写的，也就是说SUN/Sun/sun表示同样的含义（都是周日）。

特殊字符含义如下：

* \*：使用*的域可以匹配任何值，例如将月份域（第 4 个）设置为*，表示每个月；

* /：用来指定范围的步长，例如将小时域（第 2 个）设置为3-59/15表示第 3 分钟触发，以后每隔 15 分钟触发一次，因此第 2 次触发为第 18 分钟，第 3 次为 33 分钟。。。直到分钟大于 59；

* ,：用来列举一些离散的值和多个范围，例如将周历的域（第 5 个）设置为MON,WED,FRI表示周一、三和五；

* -：用来表示范围，例如将小时的域（第 1 个）设置为9-17表示上午 9 点到下午 17 点（包括 9 和 17）；

* ?：只能用在月历和周历的域中，用来代替*，表示每月/周的任意一天。

了解规则之后，我们可以定义任意时间：

* 30 * * * *：分钟域为 30，其他域都是*表示任意。每小时的 30 分触发；

* 30 3-6,20-23 * * *：分钟域为 30，小时域的3-6,20-23表示 3 点到 6 点和 20 点到 23 点。3,4,5,6,20,21,22,23 时的 30 分触发；

* 0 0 1 1 *：1（第 4 个） 月 1（第 3 个） 号的 0（第 2 个） 时 0（第 1 个） 分触发。

### 预定义时间规则

为了方便使用，cron预定义了一些时间规则：

* @yearly：也可以写作

* @annually：表示每年第一天的 0 点。等价于0 0 1 1 *；

* @monthly：表示每月第一天的 0 点。等价于0 0 1 * *；

* @weekly：表示每周第一天的 0 点，注意第一天为周日，即周六结束，周日开始的那个 0 点。等价于0 0 * * 0；

* @daily：也可以写作@midnight，表示每天 0 点。等价于0 0 * * *；

* @hourly：表示每小时的开始。等价于0 * * * *。

### 时区

默认情况下，所有时间都是基于当前时区的。当然我们也可以指定时区，有 2 两种方式：

* 在时间字符串前面添加一个CRON_TZ= + 具体时区，具体时区的格式在之前carbon的文章中有详细介绍。东京时区为Asia/Tokyo，纽约时区为America/New_York；

* 创建cron对象时增加一个时区选项`cron.WithLocation(location)`，location为`time.LoadLocation(zone)`加载的时区对象，zone为具体的时区格式。或者调用已创建好的cron对象的SetLocation()方法设置时区。

### 固定时间间隔

cron支持固定时间间隔，格式为：

@every <duration>
含义为每隔duration触发一次。<duration>会调用time.ParseDuration()函数解析，所以ParseDuration支持的格式都可以。例如1h30m10s。

### 选项

* cron对象创建使用了选项模式：

* WithLocation：指定时区；

* WithParser：使用自定义的解析器；

* WithSeconds：让时间格式支持秒，实际上内部调用了WithParser。

* WithLogger：自定义Logger；

* WithChain：Job 包装器。